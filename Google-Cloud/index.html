
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for DIVE">
      
      
      
        <meta name="author" content="Kitware">
      
      
        <link rel="canonical" href="https://kitware.github.io/dive/Google-Cloud/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.9">
    
    
      
        <title>Google Cloud Integration - DIVE</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
  



  
  



  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-6042509-43","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#google-cloud" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DIVE" class="md-header__button md-logo" aria-label="DIVE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M327.1 96c-89.97 0-168.54 54.77-212.27 101.63L27.5 131.58c-12.13-9.18-30.24.6-27.14 14.66L24.54 256 .35 365.77c-3.1 14.06 15.01 23.83 27.14 14.66l87.33-66.05C158.55 361.23 237.13 416 327.1 416 464.56 416 576 288 576 256S464.56 96 327.1 96zm87.43 184c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24 13.26 0 24 10.74 24 24 0 13.25-10.75 24-24 24z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DIVE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Google Cloud Integration
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/Kitware/dive/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DIVE" class="md-nav__button md-logo" aria-label="DIVE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M327.1 96c-89.97 0-168.54 54.77-212.27 101.63L27.5 131.58c-12.13-9.18-30.24.6-27.14 14.66L24.54 256 .35 365.77c-3.1 14.06 15.01 23.83 27.14 14.66l87.33-66.05C158.55 361.23 237.13 416 327.1 416 464.56 416 576 288 576 256S464.56 96 327.1 96zm87.43 184c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24 13.26 0 24 10.74 24 24 0 13.25-10.75 24-24 24z"/></svg>

    </a>
    DIVE
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/Kitware/dive/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Screenshots/" class="md-nav__link">
        Screenshots
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Web-Version/" class="md-nav__link">
        Web Version
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Dive-Desktop/" class="md-nav__link">
        Desktop Version
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Annotation-QuickStart/" class="md-nav__link">
        Annotation Quickstart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Mouse-Keyboard-Shortcuts/" class="md-nav__link">
        Mouse and Keyboard Shortcuts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Pipeline-Documentation/" class="md-nav__link">
        Pipelines & Training
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Annotation Interface Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Annotation Interface Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Annotation Interface Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Annotation-User-Interface-Overview/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../UI-Navigation-Bar/" class="md-nav__link">
        Navigation Bar
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../UI-Edit-Bar/" class="md-nav__link">
        Edit Bar
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../UI-Annotation-View/" class="md-nav__link">
        Annotation View
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../UI-Type-List/" class="md-nav__link">
        Type List
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../UI-Track-List/" class="md-nav__link">
        Track List
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../UI-Interpolation/" class="md-nav__link">
        Interpolation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Attributes/" class="md-nav__link">
        Attributes
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Google Cloud Integration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Google Cloud Integration
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concepts" class="md-nav__link">
    Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support" class="md-nav__link">
    Support
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-cloud-storage-mirroring" class="md-nav__link">
    Google Cloud Storage Mirroring
  </a>
  
    <nav class="md-nav" aria-label="Google Cloud Storage Mirroring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-access-credentials" class="md-nav__link">
    Creating access credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-cors" class="md-nav__link">
    Setting up CORS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubsub-notifications" class="md-nav__link">
    Pub/Sub notifications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choose-a-mount-point" class="md-nav__link">
    Choose a mount point
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-us-the-details" class="md-nav__link">
    Send us the details
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-viame-gpu-workloads" class="md-nav__link">
    Running VIAME GPU Workloads
  </a>
  
    <nav class="md-nav" aria-label="Running VIAME GPU Workloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    Preparation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-terraform" class="md-nav__link">
    Run Terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provision-with-ansible" class="md-nav__link">
    Provision with Ansible
  </a>
  
    <nav class="md-nav" aria-label="Provision with Ansible">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extra-vars" class="md-nav__link">
    Extra Vars
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#digression-provision-local-hardware-with-ansible" class="md-nav__link">
    Digression: Provision local hardware with Ansible
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-that-it-worked" class="md-nav__link">
    Checking that it worked
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#destroying-the-stack" class="md-nav__link">
    Destroying the stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      <label class="md-nav__link" for="__nav_10">
        Advanced features
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Advanced features" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Advanced features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Pipeline-Upload/" class="md-nav__link">
        Custom Pipeline Upload
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Command-Line-Tools/" class="md-nav__link">
        Command Line Tools
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Server-Operator/" class="md-nav__link">
        Server Operator Guide
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../FAQ/" class="md-nav__link">
        Frequently Asked Questions
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concepts" class="md-nav__link">
    Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support" class="md-nav__link">
    Support
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-cloud-storage-mirroring" class="md-nav__link">
    Google Cloud Storage Mirroring
  </a>
  
    <nav class="md-nav" aria-label="Google Cloud Storage Mirroring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-access-credentials" class="md-nav__link">
    Creating access credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-cors" class="md-nav__link">
    Setting up CORS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubsub-notifications" class="md-nav__link">
    Pub/Sub notifications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choose-a-mount-point" class="md-nav__link">
    Choose a mount point
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-us-the-details" class="md-nav__link">
    Send us the details
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-viame-gpu-workloads" class="md-nav__link">
    Running VIAME GPU Workloads
  </a>
  
    <nav class="md-nav" aria-label="Running VIAME GPU Workloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    Preparation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-terraform" class="md-nav__link">
    Run Terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provision-with-ansible" class="md-nav__link">
    Provision with Ansible
  </a>
  
    <nav class="md-nav" aria-label="Provision with Ansible">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extra-vars" class="md-nav__link">
    Extra Vars
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#digression-provision-local-hardware-with-ansible" class="md-nav__link">
    Digression: Provision local hardware with Ansible
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-that-it-worked" class="md-nav__link">
    Checking that it worked
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#destroying-the-stack" class="md-nav__link">
    Destroying the stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Kitware/dive/edit/master/docs/Google-Cloud.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="google-cloud">Google Cloud</h1>
<p>This guide is intended for VIAME Web users who would like to use Google Cloud resources to store and process data.  Your data will live in GCS Buckets and can be analyzed on either Kitware's servers or your own cloud service workers.</p>
<p><img alt="Google Cloud Diagram" src="../images/Diagrams/Google-Cloud.png" /></p>
<h2 id="concepts">Concepts</h2>
<ul>
<li>Kitware maintains <a href="https://viame.kitware.com">viame.kitware.com</a> web server deployment.</li>
<li>You own and manage your data in cloud storage buckets.</li>
<li>(optional) You run worker nodes that process your own personal job queue.</li>
</ul>
<p>There are several benefits to this configuration:</p>
<ul>
<li>Our team can provide support and troubleshooting directly on your data and error logs.</li>
<li>Our team manages deployments, updates, and maintenance.</li>
<li>Our team can provide recommendatations for annotation and analysis based on your specific data and needs.</li>
</ul>
<h2 id="support">Support</h2>
<p><a href="https://kitware.github.io/dive/#get-help">Contact us</a> for support with any of these topics.</p>
<h2 id="google-cloud-storage-mirroring">Google Cloud Storage Mirroring</h2>
<p>DIVE Web can mirror your data from google cloud storage buckets such that your team fully controls upload and data organization, but is able to view, annotation, and run analysis on that data in the DIVE platform.</p>
<h3 id="creating-access-credentials">Creating access credentials</h3>
<ol>
<li>Create a new <a href="https://cloud.google.com/iam/docs/creating-managing-service-accounts">service account</a> with read-only access to the bucket(s) and prefixes that you want to map.</li>
<li>In <a href="https://console.cloud.google.com/storage/settings">storage settings</a>, in the interoperability tab, create an access key (Service account HMAC) for your read-only service account.</li>
</ol>
<h3 id="setting-up-cors">Setting up CORS</h3>
<p>You'll also need to <a href="https://cloud.google.com/storage/docs/configuring-cors">configure CORS headers</a> for any buckets where media will be served.</p>
<p>Save the following snippet as <code>bucket-cors-config.json</code> .</p>
<pre><code class="language-json">[
  {
    &quot;origin&quot;: [&quot;https://viame.kitware.com&quot;],
    &quot;method&quot;: [&quot;GET&quot;],
    &quot;responseHeader&quot;: [&quot;Content-Type&quot;],
    &quot;maxAgeSeconds&quot;: 3600
  }
]
</code></pre>
<p>Then use <code>gsutils</code> to configure each bucket.</p>
<pre><code class="language-bash">gsutil cors set bucket-cors-config.json gs://BUCKET_NAME
</code></pre>
<h3 id="pubsub-notifications">Pub/Sub notifications</h3>
<p>To keep the mount up-to-date with new data added to your bucket, please create a Pub/Sub subscription on the bucket.</p>
<ol>
<li><a href="https://cloud.google.com/storage/docs/reporting-changes#enabling">Create a bucket notification configuration</a></li>
<li><a href="https://cloud.google.com/pubsub/docs/admin#pubsub_create_pull_subscription-console">Create a topic subscription</a></li>
<li><a href="https://cloud.google.com/pubsub/docs/admin#pubsub_create_pull_subscription-console">Set a push delivery method for the subsciption</a><ol>
<li>The URL for delivery should be <code>https://viame.kitware.com/api/v1/bucket_notifications/gcs</code></li>
</ol>
</li>
</ol>
<p>Our server will process events from this subscription to keep your data current.</p>
<h3 id="choose-a-mount-point">Choose a mount point</h3>
<p>Choose a folder as a mount-point inside DIVE Web.  This folder should ideally be dedicated to mapping from your GCS buckets.</p>
<p>We recommend creating a <code>Google Cloud Storage</code> folder with subfolders named for each bucket in your user's workspace.  You can do this using the <code>New Folder</code> button in DIVE Web's File Browser.  You can get the folder ID from the browser's URL bar.</p>
<h3 id="send-us-the-details">Send us the details</h3>
<p>Send an email with the following details from above to <code>viame-web@kitware.com</code> .</p>
<pre><code class="language-text">subject: Add a google cloud storage bucket mount

Bucket name:
Service provider: Google cloud
Access Key: 
Secret Key:
Mount point folder:
Prefix (if applicable):
</code></pre>
<h2 id="running-viame-gpu-workloads">Running VIAME GPU Workloads</h2>
<p>This section will guide you through deploying VIAME to Google Cloud for several use cases.</p>
<ul>
<li>Run VIAME pipelines in Google Cloud from the command line.</li>
<li>Run a GPU worker in Google Cloud (or anywhere you have GPU resources) to process your queue from viame.kitware.com.</li>
</ul>
<h3 id="how-it-works">How it works</h3>
<ul>
<li>You must <a href="https://viame.kitware.com/#jobs">toggle your private queue</a></li>
<li>When you trigger jobs (like transcoding, pipelines, or training), they go into a special queue just for your user account.</li>
<li>You are responsible for running a worker.  Your worker is a Celery process that will connect to our public RabbitMQ server.</li>
<li>Jobs submitted through the interface at viame.kitware.com will run on your compute resources.  This involves automatically downloading the video or images and annotation files, running a kwiver pipeline, and uploading the results.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: To run the worker on existing compute resources using docker, <a href="https://github.com/Kitware/dive/blob/main/docker/README.md">see the docker standalone worker docs</a>.</p>
</blockquote>
<h3 id="preparation">Preparation</h3>
<p>To run the provisioning tools below, you need the following installed on your workstation.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Google Cloud worker provisioning can <strong>only be done</strong> from an Ubuntu Linux 18.04+ host.  Ansible and terraform should work on Windows Subsystem for Linux (WSL) if you only have a windows host.  You could also use a cheap CPU-only cloud instance to run these tools.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Google Cloud imposes GPU Quotas.  You may need to <a href="https://cloud.google.com/compute/quotas">request a quota increase</a>.  Anecdotally, request increases of 1 unit are approved automatically, but more are rejected.</p>
</div>
<ul>
<li><a href="https://cloud.google.com/sdk/docs/install">Install Google Cloud SDK</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/terraform/install-cli">Install Terraform</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">Install Ansible</a></li>
<li>find your google cloud project id.  It looks like <code>project-name-123456</code>.</li>
</ul>
<pre><code class="language-bash"># Clone the dive repo
git clone https://github.com/Kitware/dive.git
cd dive/devops

# Install ansible
pip3 install ansible

# Generate an ssh key
ssh-keygen -t ed25519 -f ~/.ssh/gcloud_key
</code></pre>
<h3 id="run-terraform">Run Terraform</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>GPU resources cost money.  Make sure you are familiar with the cost of the machine and gpu you choose.  See main.tf for default values.</p>
</div>
<pre><code class="language-bash"># Authenticate with google cloud

gcloud auth application-default login

# Verify your GPU Quota
# https://cloud.google.com/compute/docs/gpus/create-vm-with-gpus
# REGION might change.

gcloud compute regions describe us-central1

# Run plan
# See `devops/main.tf` for a complete list of variables
# the default macine_type and gpu_type can be overridden

terraform plan -var &quot;project_name=&lt;GCloud-Project-Id&gt;&quot; -out create.plan

# Run apply
terraform apply create.plan
</code></pre>
<h3 id="provision-with-ansible">Provision with Ansible</h3>
<p>This step will prepare the new host to run a VIAME worker by installing nvidia drivers, docker, and downloading VIAME and all optional addons.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The playbook may take 30 minutes or more to run because it must install nvidia drivers and download several GB of software packages.</p>
</div>
<h4 id="extra-vars">Extra Vars</h4>
<p>The supported extra vars to pass to ansible.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIVE_USERNAME</td>
<td>null</td>
<td>Required. Username to start private queue processor</td>
</tr>
<tr>
<td>DIVE_PASSWORD</td>
<td>null</td>
<td>Required. Password for private queue processor</td>
</tr>
<tr>
<td>WORKER_CONCURRENCY</td>
<td><code>2</code></td>
<td>Optional. max concurrnet jobs. <strong>Change this to 1 if you run training</strong></td>
</tr>
<tr>
<td>KWIVER_DEFAULT_LOG_LEVEL</td>
<td><code>warn</code></td>
<td>Optional. kwiver log level</td>
</tr>
<tr>
<td>DIVE_API_URL</td>
<td><code>https://viame.kitware.com/api/v1</code></td>
<td>Optional. Remote URL to authenticate against.</td>
</tr>
<tr>
<td>viame_bundle_url</td>
<td>latest bundle url</td>
<td>Optional.  Change to install a different version of VIAME.  This should be a link to the latest Ubuntu Desktop (18/20) binaries from viame.kitware.com (Mirror 1)</td>
</tr>
</tbody>
</table>
<pre><code class="language-bash"># install galaxy plugins
ansible-galaxy install -r ansible/requirements.yml

# provision using inventory file automatically created by terraform and the connection string you got from us
ansible-playbook -i inventory ansible/playbook.yml --extra-vars &quot;DIVE_USERNAME=username DIVE_PASSWORD=changeme&quot;
</code></pre>
<p>Once provisioning is complete, jobs should begin processing from the job queue.  You can check <a href="https://viame.kitware.com/#/jobs">viame.kitware.com/#/jobs</a> to see queue progress and logs.</p>
<h4 id="digression-provision-local-hardware-with-ansible">Digression: Provision local hardware with Ansible</h4>
<p>If you want to run the VIAME Worker node on a workstation, shared server, or in another cloud environment, you can run the worker in standalone mode using the <a href="https://github.com/Kitware/dive/tree/main/docker#running-the-gpu-job-runner-in-standalone-mode">docker docs</a>. You may even still be able to provision the target host using this ansible playbook.</p>
<p>This ansible playbook is runnable from any Ubuntu 18.04+ host to any Ubuntu 18.04+ target.  To run it locally, use the <code>inventory.local</code> file instead.  If you already have nvidia or docker installed, you can comment out these lines in the playbook.</p>
<pre><code class="language-bash">ansible-playbook --ask-become-pass -i inventory ansible/playbook.yml --extra-vars &quot;DIVE_USERNAME=username DIVE_PASSWORD=changeme&quot;
</code></pre>
<h4 id="checking-that-it-worked">Checking that it worked</h4>
<pre><code class="language-bash"># Log in with the ip address from the inventory file (or google cloud dashboard)
ssh -i ~/.ssh/gcloud_key viame@ip-address

# See if viame started
# You should see &quot;celery@identifier ready.&quot; in the logs
sudo docker logs -f worker
</code></pre>
<p>You can <a href="https://viame.kitware.com/#jobs">enable your private queue on the jobs page</a> and begin running jobs.</p>
<h3 id="destroying-the-stack">Destroying the stack</h3>
<p>When your work is complete, use terraform to destroy your resources.</p>
<pre><code class="language-bash">terraform destroy -var &quot;project_name=&lt;GCloud-Project-Id&gt;&quot;
</code></pre>
<h2 id="troubleshooting">Troubleshooting</h2>
<ul>
<li>Ansible provisioning is idempotent.  If it fails, run it again once or twice.</li>
<li>You may need to change the global <code>GPUS_ALL_REGIONS</code> quota in <a href="https://stackoverflow.com/questions/53415180/gcp-error-quota-gpus-all-regions-exceeded-limit-0-0-globally">IAM -&gt; Quotas</a></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../Attributes/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Attributes" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Attributes
            </div>
          </div>
        </a>
      
      
        
        <a href="../Pipeline-Upload/" class="md-footer__link md-footer__link--next" aria-label="Next: Custom Pipeline Upload" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Custom Pipeline Upload
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.82b56eb2.min.js"></script>
      
    
  </body>
</html>